<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Star列表</title>
    <th:block layout:fragment="head">
        <style>
            .search-bar {
                background: white;
                border-radius: 12px;
                padding: 20px 24px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
                margin-bottom: 24px;
            }
            .repo-card {
                background: white;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
                transition: transform 0.2s, box-shadow 0.2s;
                height: 100%;
                display: flex;
                flex-direction: column;
            }
            .repo-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            }
            .repo-card .repo-header {
                display: flex;
                align-items: center;
                margin-bottom: 12px;
            }
            .repo-card .owner-avatar {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                margin-right: 12px;
                border: 2px solid #e9ecef;
            }
            .repo-card .repo-name {
                font-size: 1.05rem;
                font-weight: 600;
                color: #0969da;
                text-decoration: none;
                word-break: break-all;
            }
            .repo-card .repo-name:hover {
                text-decoration: underline;
            }
            .repo-card .owner-name {
                font-size: 0.85rem;
                color: #656d76;
            }
            .repo-card .repo-desc {
                color: #555;
                font-size: 0.9rem;
                line-height: 1.5;
                flex: 1;
                margin-bottom: 12px;
                display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            .repo-card .repo-meta {
                display: flex;
                align-items: center;
                flex-wrap: wrap;
                gap: 12px;
                font-size: 0.85rem;
                color: #656d76;
                margin-top: auto;
            }
            .repo-card .repo-meta .meta-item {
                display: flex;
                align-items: center;
                gap: 4px;
            }
            .lang-badge {
                display: inline-block;
                padding: 2px 10px;
                border-radius: 12px;
                font-size: 0.78rem;
                font-weight: 500;
                background-color: #ddf4ff;
                color: #0969da;
            }
            .stats-summary {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 12px;
                padding: 20px 24px;
                color: white;
                margin-bottom: 24px;
            }
            .stats-summary h5 {
                margin: 0;
                font-weight: 300;
                font-size: 0.9rem;
                opacity: 0.85;
            }
            .stats-summary .stat-num {
                font-size: 1.8rem;
                font-weight: 700;
            }
            .page-link-custom {
                border-radius: 8px !important;
                margin: 0 2px;
                border: none;
                color: #495057;
                font-weight: 500;
            }
            .page-link-custom.active-page {
                background-color: #0969da;
                color: white;
            }
            .empty-state {
                text-align: center;
                padding: 60px 20px;
                color: #8892a0;
            }
            .empty-state i {
                font-size: 4rem;
                margin-bottom: 16px;
                display: block;
            }
            .form-select, .form-control {
                border-radius: 8px;
                border: 1px solid #d0d7de;
            }
            .form-select:focus, .form-control:focus {
                border-color: #0969da;
                box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.15);
            }
            .btn-search {
                background-color: #0969da;
                color: white;
                border: none;
                border-radius: 8px;
                padding: 6px 20px;
                font-weight: 500;
            }
            .btn-search:hover {
                background-color: #0757b5;
                color: white;
            }
            .btn-reset {
                border: 1px solid #d0d7de;
                border-radius: 8px;
                padding: 6px 16px;
                color: #656d76;
                background: white;
            }
            .btn-reset:hover {
                background-color: #f6f8fa;
                color: #333;
            }
        </style>
    </th:block>
</head>
<body>
<div layout:fragment="content">

    <!-- 统计摘要 -->
    <div class="stats-summary">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h5>已收藏的 GitHub 仓库</h5>
                <span class="stat-num" th:text="${totalCount}">0</span>
                <span style="font-weight: 300; opacity: 0.85;"> 个仓库</span>
            </div>
            <div class="col-md-4 text-md-end" th:if="${totalCount > 0}">
                <span style="font-size: 0.9rem; opacity: 0.75;">
                    第 <span th:text="${currentPage}">1</span> / <span th:text="${totalPages}">1</span> 页
                </span>
            </div>
        </div>
    </div>

    <!-- 搜索与筛选栏 -->
    <div class="search-bar">
        <form th:action="@{/}" method="get">
            <div class="row g-2 align-items-end">
                <div class="col-md-4">
                    <label class="form-label fw-semibold" style="font-size: 0.85rem; color: #656d76;">
                        <i class="bi bi-search"></i> 搜索关键词
                    </label>
                    <input type="text" class="form-control" name="keyword" th:value="${keyword}"
                           placeholder="搜索仓库名、描述、作者...">
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-semibold" style="font-size: 0.85rem; color: #656d76;">
                        <i class="bi bi-code-slash"></i> 编程语言
                    </label>
                    <select class="form-select" name="language">
                        <option value="">全部语言</option>
                        <option th:each="lang : ${languages}" th:value="${lang}" th:text="${lang}"
                                th:selected="${lang == language}">Language</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-semibold" style="font-size: 0.85rem; color: #656d76;">
                        <i class="bi bi-sort-down"></i> 排序方式
                    </label>
                    <select class="form-select" name="sortBy">
                        <option value="starred_at" th:selected="${sortBy == 'starred_at'}">Star时间</option>
                        <option value="stars_count" th:selected="${sortBy == 'stars_count'}">Star数量</option>
                        <option value="forks_count" th:selected="${sortBy == 'forks_count'}">Fork数量</option>
                        <option value="repo_updated_at" th:selected="${sortBy == 'repo_updated_at'}">更新时间</option>
                        <option value="repo_created_at" th:selected="${sortBy == 'repo_created_at'}">创建时间</option>
                        <option value="repo_pushed_at" th:selected="${sortBy == 'repo_pushed_at'}">推送时间</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-semibold" style="font-size: 0.85rem; color: #656d76;">
                        <i class="bi bi-arrow-down-up"></i> 排序方向
                    </label>
                    <select class="form-select" name="sortOrder">
                        <option value="desc" th:selected="${sortOrder == 'desc'}">降序</option>
                        <option value="asc" th:selected="${sortOrder == 'asc'}">升序</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label" style="visibility: hidden; font-size: 0.85rem;">操作</label>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-search flex-fill">
                            <i class="bi bi-search"></i> 搜索
                        </button>
                        <a th:href="@{/}" class="btn btn-reset">
                            <i class="bi bi-x-circle"></i>
                        </a>
                    </div>
                </div>
            </div>
            <!-- 时间范围筛选 -->
            <div class="row g-2 align-items-end mt-1">
                <div class="col-md-3">
                    <label class="form-label fw-semibold" style="font-size: 0.85rem; color: #656d76;">
                        <i class="bi bi-calendar-range"></i> 时间字段
                    </label>
                    <select class="form-select" name="dateField">
                        <option value="">不限时间</option>
                        <option value="starred_at" th:selected="${dateField == 'starred_at'}">Star 时间</option>
                        <option value="repo_created_at" th:selected="${dateField == 'repo_created_at'}">仓库创建时间</option>
                        <option value="repo_updated_at" th:selected="${dateField == 'repo_updated_at'}">更新时间</option>
                        <option value="repo_pushed_at" th:selected="${dateField == 'repo_pushed_at'}">推送时间</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-semibold" style="font-size: 0.85rem; color: #656d76;">
                        <i class="bi bi-calendar-event"></i> 起始月份
                    </label>
                    <input type="month" class="form-control" name="startMonth" th:value="${startMonth}">
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-semibold" style="font-size: 0.85rem; color: #656d76;">
                        <i class="bi bi-calendar-check"></i> 结束月份
                    </label>
                    <input type="month" class="form-control" name="endMonth" th:value="${endMonth}">
                </div>
                <div class="col-md-3">
                    <label class="form-label" style="visibility: hidden; font-size: 0.85rem;">提示</label>
                    <div class="text-muted" style="font-size: 0.8rem; padding: 6px 0;">
                        <i class="bi bi-info-circle"></i> 选择时间字段后设置月份范围
                    </div>
                </div>
            </div>
            <input type="hidden" name="size" th:value="${size}">
        </form>
    </div>

    <!-- 仓库卡片列表 -->
    <div th:if="${#lists.isEmpty(repos)}" class="empty-state">
        <i class="bi bi-inbox"></i>
        <h5>暂无数据</h5>
        <p th:if="${#strings.isEmpty(keyword) and #strings.isEmpty(language)}">
            还没有同步任何 Star 仓库，请先进行同步操作。
        </p>
        <p th:unless="${#strings.isEmpty(keyword) and #strings.isEmpty(language)}">
            没有找到符合条件的仓库，请尝试调整搜索条件。
        </p>
    </div>

    <div class="row g-3" th:unless="${#lists.isEmpty(repos)}">
        <div class="col-md-6 col-lg-4" th:each="repo : ${repos}">
            <div class="repo-card">
                <div class="repo-header">
                    <img class="owner-avatar" th:src="${repo.ownerAvatarUrl}" th:alt="${repo.ownerName}"
                         onerror="this.src='https://github.githubassets.com/images/gravatars/gravatar-user-420.png'">
                    <div>
                        <a class="repo-name" th:href="@{'/stars/' + ${repo.id}(backQuery=${queryString})}" th:text="${repo.repoName}">repo-name</a>
                        <div class="owner-name" th:text="${repo.ownerName}">owner</div>
                    </div>
                </div>
                <div class="repo-desc" th:text="${repo.description != null ? repo.description : '暂无描述'}">
                    仓库描述信息
                </div>
                <div class="repo-meta">
                    <span class="lang-badge" th:if="${repo.language != null}" th:text="${repo.language}">Java</span>
                    <span class="meta-item">
                        <i class="bi bi-star-fill" style="color: #e3b341;"></i>
                        <span th:text="${repo.starsCount}">0</span>
                    </span>
                    <span class="meta-item">
                        <i class="bi bi-diagram-2" style="color: #8250df;"></i>
                        <span th:text="${repo.forksCount}">0</span>
                    </span>
                    <span class="meta-item" th:if="${repo.starredAt != null}">
                        <i class="bi bi-clock"></i>
                        <span th:text="${#temporals.format(repo.starredAt, 'yyyy-MM-dd')}">2024-01-01</span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- 分页导航 -->
    <nav th:if="${totalPages > 1}" class="mt-4 d-flex justify-content-center">
        <ul class="pagination mb-0">
            <!-- 上一页 -->
            <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                <a class="page-link page-link-custom"
                   th:href="@{/(page=${currentPage - 1}, size=${size}, keyword=${keyword}, language=${language}, sortBy=${sortBy}, sortOrder=${sortOrder}, dateField=${dateField}, startMonth=${startMonth}, endMonth=${endMonth})}"
                   th:if="${currentPage > 1}">
                    <i class="bi bi-chevron-left"></i>
                </a>
                <span class="page-link page-link-custom" th:if="${currentPage == 1}">
                    <i class="bi bi-chevron-left"></i>
                </span>
            </li>

            <!-- 第一页 + 省略号 -->
            <li class="page-item" th:if="${startPage > 1}">
                <a class="page-link page-link-custom"
                   th:href="@{/(page=1, size=${size}, keyword=${keyword}, language=${language}, sortBy=${sortBy}, sortOrder=${sortOrder}, dateField=${dateField}, startMonth=${startMonth}, endMonth=${endMonth})}">1</a>
            </li>
            <li class="page-item disabled" th:if="${startPage > 2}">
                <span class="page-link page-link-custom">...</span>
            </li>

            <!-- 页码 -->
            <li class="page-item" th:each="i : ${#numbers.sequence(startPage, endPage)}">
                <a class="page-link page-link-custom" th:classappend="${i == currentPage} ? 'active-page'"
                   th:href="@{/(page=${i}, size=${size}, keyword=${keyword}, language=${language}, sortBy=${sortBy}, sortOrder=${sortOrder}, dateField=${dateField}, startMonth=${startMonth}, endMonth=${endMonth})}"
                   th:text="${i}">1</a>
            </li>

            <!-- 省略号 + 最后一页 -->
            <li class="page-item disabled" th:if="${endPage < totalPages - 1}">
                <span class="page-link page-link-custom">...</span>
            </li>
            <li class="page-item" th:if="${endPage < totalPages}">
                <a class="page-link page-link-custom"
                   th:href="@{/(page=${totalPages}, size=${size}, keyword=${keyword}, language=${language}, sortBy=${sortBy}, sortOrder=${sortOrder}, dateField=${dateField}, startMonth=${startMonth}, endMonth=${endMonth})}"
                   th:text="${totalPages}">99</a>
            </li>

            <!-- 下一页 -->
            <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                <a class="page-link page-link-custom"
                   th:href="@{/(page=${currentPage + 1}, size=${size}, keyword=${keyword}, language=${language}, sortBy=${sortBy}, sortOrder=${sortOrder}, dateField=${dateField}, startMonth=${startMonth}, endMonth=${endMonth})}"
                   th:if="${currentPage < totalPages}">
                    <i class="bi bi-chevron-right"></i>
                </a>
                <span class="page-link page-link-custom" th:if="${currentPage == totalPages}">
                    <i class="bi bi-chevron-right"></i>
                </span>
            </li>
        </ul>
    </nav>

</div>

<th:block layout:fragment="scripts">
    <script>
        // 高亮当前导航项
        document.getElementById('nav-stars').classList.add('active');
    </script>
</th:block>
</body>
</html>
